@page "{subjectId:Guid}"
@model TutorDemand.RazorWebApp.Pages.Subject.UpdateModel
@{
}

<div class="mx-auto max-w-3xl rounded-lg bg-white p-8 shadow-lg">
    <h1 class="mb-4 text-2xl font-bold">Add Subject</h1>
    <div class="bg-gray-100 p-8">
        <form method="post" asp-page-handler="Edit">
            <input type="text" class="form-control" id="Id" asp-for="SubjectDto.SubjectId" hidden>
            <div class="mb-4">
                <label asp-for="SubjectDto.SubjectCode"
                       class="mb-2 block font-bold text-gray-700">
                    Code
                </label>
                <input asp-for="SubjectDto.SubjectCode" type="text"
                       class="w-1/2 appearance-none rounded border px-3 py-2 leading-tight text-gray-700 shadow focus:outline-none focus:shadow-outline"/><br/>
                <span asp-validation-for="SubjectDto.SubjectCode"
                      class="text-sm italic text-red-500">
                </span>
            </div>

            <div class="mb-4">
                <label asp-for="SubjectDto.Name"
                       class="mb-2 block font-bold text-gray-700">
                    Name
                </label>
                <input asp-for="SubjectDto.Name" type="text"
                       class="w-1/2 appearance-none border px-3 py-2 leading-tight text-gray-700 shadow focus:outline-none focus:shadow-outline"/><br/>
                <span asp-validation-for="SubjectDto.Name"
                      class="text-sm italic text-red-500">
                </span>
            </div>

            <div class="mb-4">
                <label asp-for="SubjectDto.Image"
                       class="mb-2 block font-bold text-gray-700">
                </label>

                <!-- Show image URL (if any)-->
                <span id="showImageUrl"
                      class="text-sm underline cursor-pointer"
                      style="display:none">
                    Show image URL
                </span>
                <input asp-for="SubjectDto.Image" type="text"
                       id="imageUrl"
                       class="w-full border-none mb-4 bg-gray-100 text-blue-500 font-bold italic break-all focus:outline-none"
                       style="display:none"/><br/>

                <!-- Show subject image -->
                @if (Model.SubjectDto.Image != null)
                {
                    <img src="@Model.SubjectDto.Image" style="width: 300px;" id="subjectImageDisplay"/>
                }
                else
                {
                    <img src="#" style="display: none;" id="subjectImageDisplay"/>
                }

                <!-- Select file handling-->
                <input type="button"
                       id="subjectImageTarget"
                       value="Browse"
                       class="text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-3 py-2 me-2 mb-2 cursor-pointer"
                       onclick="document.getElementById('file').click();"/>
                <input type="file" style="display:none;" id="file"/>

            </div>

            <div class="mb-4">
                <label asp-for="SubjectDto.Description" for="descriptionEditor"
                       class="mb-2 block font-bold text-gray-700">
                    Description
                </label>
                <textarea type="text" id="descriptionEditor" asp-for="SubjectDto.Description"></textarea>
            </div>

            <div class="flex justify-end gap-x-4">
                <a href="/subject/list" class="w-32 cursor-pointer rounded-lg border border-primary bg-gray-100 px-4 py-2 text-center text-primary hover:opacity-85">
                    Back to List
                </a>
                <button type="submit" class="w-32 cursor-pointer rounded-lg bg-primary px-4 py-2 text-white hover:opacity-85">UpdateAsync</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>

        $(document).ready(function () {

            var editor = new FroalaEditor('#descriptionEditor', {
                imageUrl: '/api/images'
            });

            const imageUrl = document.getElementById("imageUrl");
            const showImageUrl = document.getElementById("showImageUrl");
            const subjectImageDisplay = document.getElementById("subjectImageDisplay");
            const subjectImageInput = document.getElementById("file");

            async function handleImageAction(e) {
                let data = new FormData();
                data.append('file', e.target.files[0])

                await fetch('/api/images', {
                    method: 'POST',
                    headers: {
                        'Accept': '*/*'
                    },
                    body: data
                }).then(response => response.json()).then(result => {
                    imageUrl.value = result.link;
                    imageUrl.style.display = 'none';
                    subjectImageDisplay.style.display = 'block';
                    subjectImageDisplay.src = result.link;
                    showImageUrl.style.display = 'block';
                })

            }

            function handleShowImage() {
                if (imageUrl.value !== "" && imageUrl) {
                    imageUrl.style.display = 'block';
                    showImageUrl.style.display = 'none';
                }
            }

            subjectImageInput.addEventListener('change', handleImageAction);
            showImageUrl.addEventListener('click', handleShowImage);
        });
    </script>
}